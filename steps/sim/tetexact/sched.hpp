////////////////////////////////////////////////////////////////////////////////
// STEPS - STochastic Engine for Pathway Simulation
// Copyright (C) 2005-2007 Stefan Wils. All rights reserved.
//
// $Id$
////////////////////////////////////////////////////////////////////////////////

#ifndef STEPS_SIM_TETEXACT_SCHED_HPP
#define STEPS_SIM_TETEXACT_SCHED_HPP 1

// Autotools definitions.
#ifdef HAVE_CONFIG_H
#include <steps/config.h>
#endif

// Standard library & STL headers.
#include <map>
#include <string>
#include <vector>

// STEPS headers.
#include <steps/common.h>
#include <steps/math/constants.hpp>

////////////////////////////////////////////////////////////////////////////////

// Forward declarations.

// See: steps/sim/tetexact/kproc.hpp
class KProc;
// See: steps/sim/tetexact/state.hpp
class State;

// Auxiliary declarations.

typedef uint                            SchedIDX;

typedef std::vector<SchedIDX>           SchedIDXVec;
typedef SchedIDXVec::iterator           SchedIDXVecI;
typedef SchedIDXVec::const_iterator     SchedIDXVecCI;

////////////////////////////////////////////////////////////////////////////////

class Sched
{

public:

    ////////////////////////////////////////////////////////////////////////
    // OBJECT CONSTRUCTION & DESTRUCTION
    ////////////////////////////////////////////////////////////////////////

    Sched(void);
    
    ~Sched(void);
    
    void addKProc(KProc * kproc);
    
    void build();
    
    ////////////////////////////////////////////////////////////////////////
    // SCHEDULE OPERATIONS
    ////////////////////////////////////////////////////////////////////////
    
    inline double getA0(void) const
    { return pA0; }
    
    KProc * getNext(State * s) const;
    
    void reset(void);
    
    void recomp(void);
    
    void update(SchedIDXVec const & entries);

private:

    ////////////////////////////////////////////////////////////////////////
    // LIST OF KPROCS
    ////////////////////////////////////////////////////////////////////////
    
    std::vector<KProc *>                        pKProcs;
    
    ////////////////////////////////////////////////////////////////////////
    // N-ARY TREE
    ////////////////////////////////////////////////////////////////////////
    
    double                                      pA0;
    
    std::vector<uint>                           pLevelSizes;
    
    std::vector<double*>                        pLevels;
    
    ////////////////////////////////////////////////////////////////////////

};

////////////////////////////////////////////////////////////////////////////////

#endif
// STEPS_SIM_TETEXACT_SCHED_HPP

// END
